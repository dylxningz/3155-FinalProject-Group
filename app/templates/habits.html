{% extends 'layout.html' %}

{% block title %}Listening Habits{% endblock %}

{% block content %}
<div class="sidebar">
    <hr>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link active" href="{{url_for('profile.dashboard')}}">Dashboard</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Trends</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{url_for('profile.profile')}}">Settings</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{url_for('auth.logout')}}">Logout</a>
        </li>
    </ul>
</div>

<h2 class="dashboard-top-txt">Here are your Listening Habits</h2>
<div class="container">
    <div class="row">
        <div class="col-md-5 top-songs-cnt box-main-1">
            <h3>Your Top 5 Songs:</h3>
            {% if top_songs %}
                <ul class="list-unstyled">
                    {% for song in top_songs %}
                        <li>
                            <div class="media">
                                <span class="rank">{{ song.rank }}.</span>
                                {% if song.cover %}
                                    <img src="{{ song.cover }}" alt="{{ song.name }}" style="height: 100px; width: 100px;"> 
                                {% endif %}
                                <div class="media-body">
                                    <h5 class="mt-0">{{ song.name }}</h5>
                                    {% for artist in song.artists %}
                                        <a href="{{ url_for('spotifyroutes.artist_page', artist_id=artist.id) }}">{{ artist.name }}</a>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You have no top songs from Spotify to display, or your Spotify account is not linked.</p>
            {% endif %}
        </div>
        
        <div class="col-md-5 top-genres-cnt box-main-2">
            <h3>Your Top 5 Genres:</h3>
            {% if top_genres %}
                <ul class="list-unstyled">
                    {% for genre, song_count in top_genres.items() %}
                        <li>{{ genre }} ({{ song_count }} different songs)</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You have no top genres from Spotify to display, or your Spotify account is not linked.</p>
            {% endif %}
        </div>
    </div>
    
    <div class="row mt-5">
        <div class="col-md-6">
            <h3>Graph of Top Songs:</h3>
            <canvas id="songsChart" width="400" height="400"></canvas>
        </div>
        
        <div class="col-md-6">
            <h3>Graph of Top Genres:</h3>
            <canvas id="genresChart" width="400" height="400"></canvas>
        </div>
    </div>
</div>
<!-- Graphs to display songs and genre-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Dummy Data -->
<script>
    var ctx = document.getElementById('songsChart').getContext('2d');
    var songsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Song 1', 'Song 2', 'Song 3', 'Song 4', 'Song 5'],
            datasets: [{
                label: 'Time Listening (minutes)',
                data: [30, 25, 20, 15, 10],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    var ctxGenres = document.getElementById('genresChart').getContext('2d');
    var genresChart = new Chart(ctxGenres, {
        type: 'bar',
        data: {
            labels: ['Genre 1', 'Genre 2', 'Genre 3', 'Genre 4', 'Genre 5'],
            datasets: [{
                label: 'Number of Different Songs',
                data: [10, 8, 6, 4, 2],
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

{% endblock %}