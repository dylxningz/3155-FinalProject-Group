{% extends 'layout.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<div class="sidebar">
    <hr>
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link active" href="{{url_for('profile.dashboard')}}">Dashboard</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#">Trends</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{url_for('profile.settings')}}">Settings</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{{url_for('auth.logout')}}">Logout</a>
        </li>
    </ul>
</div>
    <h2 class="dashboard-top-txt">Welcome to Your Dashboard, {{ username }}!</h2>
<div class="container">


    <div class="row">
        
        <div class="col-md-5 top-songs-cnt box-main-1">
            <h3>Your Top 5 Songs:</h3>
            {% if top_songs %}
                <ul class="list-unstyled">
                    {% for song in top_songs %}
                        <li>
                            <div class="media">
                                <span class="rank">{{ song.rank }}.</span>
                                {% if song.cover %}
                                    <img src="{{ song.cover }}" alt="{{ song.name }}" style="height: 100px; width: 100px;"> 
                                {% endif %}
                                <div class="media-body">
                                    <h5 class="mt-0">{{ song.name }}</h5>
                                    {% for artist in song.artists %}
                                        <a href="{{ url_for('spotifyroutes.artist_page', artist_id=artist.id) }}">{{ artist.name }}</a>{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You have no top songs from Spotify to display, or your Spotify account is not linked.</p>
            {% endif %}
        </div>
        
        <div class="col-md-5 top-artist-cnt box-main-2">
            <h3>Your Top Artists:</h3>
            {% if top_artists %}
                <ul class="list-unstyled">
                    {% for artist in top_artists %}
                        <li>
                            <div class="media">
                                <span class="rank">{{ artist.rank }}.</span>
                                {% if artist.cover %}
                                    <img src="{{ artist.cover }}" alt="{{ artist.name }}" style="height: 100px; width: 100px;"> 
                                {% endif %}
                                <div class="media-body">
                                    <h5 class="mt-0"><a href="{{ url_for('spotifyroutes.artist_page', artist_id=artist.id) }}">{{ artist.name }}</a></h5>
                                    <p>Genres: {{ artist.genre }}</p>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You have no top artists from Spotify to display, or your Spotify account is not linked.</p>
            {% endif %}
        </div>
        <div class="col-md-12 mt-4">
            <h3>Your Posts:</h3>
            {% if user_posts %}
                <div class="list-group">
                    {% for post in user_posts %}
                        <a href="{{ url_for('community.view_post', post_id=post.id) }}" class="list-group-item list-group-item-action flex-column align-items-start">
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1">{{ post.title }}</h5>
                                <small>{{ post.date_posted.strftime('%Y-%m-%d') }}</small>
                            </div>
                            <p class="mb-1">{{ post.content | truncate(150) }}</p>
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <p>You have not created any posts yet.</p>
            {% endif %}
        </div>
    </div>
</div>
        
        
    </div>

</div>
{% endblock %}